"use strict";var y=Object.defineProperty;var S=(e,t,r)=>t in e?y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var b=(e,t,r)=>S(e,typeof t!="symbol"?t+"":t,r);const p=require("react"),h=require("./jsx-runtime-BYECrxsp.cjs"),O=require("./types-BiGI-P88.cjs");function k(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const r in e)if(r!=="default"){const s=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:()=>e[r]})}}return t.default=e,Object.freeze(t)}const i=k(p),T={colors:{primary:{50:"#f0f9ff",100:"#e0f2fe",200:"#bae6fd",300:"#7dd3fc",400:"#38bdf8",500:"#0ea5e9",600:"#0284c7",700:"#0369a1",800:"#075985",900:"#0c4a6e"},slate:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},danger:{500:"#ef4444",600:"#dc2626"},success:{500:"#22c55e",600:"#16a34a"},warning:{500:"#eab308",600:"#ca8a04"}},radius:{sm:"0.25rem",md:"0.5rem",lg:"0.75rem",xl:"1rem","2xl":"1.5rem",full:"9999px"},spacing:{xs:"0.25rem",sm:"0.5rem",md:"1rem",lg:"1.5rem",xl:"2rem"}},D=/\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}\b/gi,M=/\b\d{3}[-.]?\d{3}[-.]?\d{4}\b/g,_=e=>{if(typeof e=="string"){let t=e;return t=t.replace(D,"[REDACTED_EMAIL]"),t=t.replace(M,"[REDACTED_PHONE]"),t}if(Array.isArray(e))return e.map(_);if(typeof e=="object"&&e!==null){const t={};for(const r in e)t[r]=_(e[r]);return t}return e},U=e=>async t=>{var r;if((r=t.flags)!=null&&r.sensitive){const s={...t,payload:_(t.payload)};return e(s)}return e(t)},C=10,I=5e3,x="/telemetry/event";class L{constructor(){b(this,"queue",[]);b(this,"timer",null);this.startTimer()}startTimer(){this.timer||(this.timer=setInterval(()=>this.flush(),I))}async flush(){if(this.queue.length===0)return;const t=[...this.queue];this.queue=[];try{process.env.NODE_ENV!=="test"&&console.log(`[AuditLogger] Mock send ${t.length} events to ${x}`)}catch(r){console.error("[AuditLogger] Failed to send events, requeuing",r),this.queue=[...t,...this.queue]}}log(t){this.queue.push(t),this.queue.length>=C&&this.flush()}}const R=new L,w=e=>async t=>{var r;await e(t),(r=t.flags)!=null&&r.persist&&R.log(t)},v=i.createContext(null),B=({children:e,sockets:t})=>{const r=i.useRef(t);i.useEffect(()=>{r.current=t},[t]);const s=i.useMemo(()=>({getSocket:o=>r.current[o],subscribe:(o,u,c)=>{const n=r.current[o];if(!n)return process.env.NODE_ENV!=="production"&&console.warn(`[SocketProvider] Socket channel "${o}" is not available`),()=>{};const d=E=>{c(E)};return n.on(u,d),()=>{n.off(u,d)}},emit:(o,u,c)=>{const n=r.current[o];if(!n){process.env.NODE_ENV!=="production"&&console.warn(`[SocketProvider] Socket channel "${o}" is not available`);return}n.emit(u,c)}}),[]);return h.jsxRuntimeExports.jsx(v.Provider,{value:s,children:e})},f=()=>{const e=i.useContext(v);if(!e)throw new Error("useSocketContext must be used within SocketProvider");return e},P=(e,t,r)=>{const{subscribe:s}=f(),o=p.useRef(r);p.useEffect(()=>{o.current=r},[r]),p.useEffect(()=>{const u=s(e,t,c=>{o.current&&o.current(c)});return()=>{u()}},[e,t,s])},q=()=>{const{emit:e}=f();return(t,r,s)=>{e(t,r,s)}},F="ai-events",V="event",H="ai-control",j="command",Z=e=>!0,$=e=>{var t,r,s;return{id:e.id,direction:"UI→AI",type:String(e.type),target:{component:(t=e.meta)==null?void 0:t.component,instanceId:(r=e.meta)==null?void 0:r.instanceId,path:(s=e.meta)==null?void 0:s.path},payload:e.payload,meta:{...e.meta,source:e.source,flags:e.flags},timestamp:e.timestamp}},G=e=>e.direction&&e.direction!=="AI→UI"?null:{type:e.type,payload:e.payload,source:"ai",meta:{...e.meta||{},target:e.target},flags:{priority:"high",persist:!0}},X=({socket:e,config:t})=>{const r=(t==null?void 0:t.enabled)!==!1;let s=null,o=null;if(r){const c=t==null?void 0:t.outbound,n=t==null?void 0:t.inbound,d=(c==null?void 0:c.enabled)!==!1,E=(n==null?void 0:n.enabled)!==!1;if(d){const N=(c==null?void 0:c.channel)||F,g=(c==null?void 0:c.eventName)||V,A=(c==null?void 0:c.filter)||Z,m=(c==null?void 0:c.mapEventToMessage)||$;s=O.actionBus.subscribeAll(l=>{try{if(!A(l))return;const a=m(l);if(!a)return;e.emit(N,g,a)}catch(a){process.env.NODE_ENV!=="production"&&console.error("[AiBridge] Outbound error",a)}})}if(E){const N=(n==null?void 0:n.channel)||H,g=(n==null?void 0:n.eventName)||j,A=(n==null?void 0:n.mapMessageToEvent)||G,m=n==null?void 0:n.onMessage;o=e.subscribe(N,g,l=>{try{m&&m(l);const a=A(l);if(!a)return;O.actionBus.publish(a)}catch(a){process.env.NODE_ENV!=="production"&&console.error("[AiBridge] Inbound error",a)}})}}return{dispose:()=>{s&&(s.unsubscribe(),s=null),o&&(o(),o=null)}}},z=({children:e,config:t})=>{const r=f(),s=i.useRef(null);return i.useEffect(()=>(s.current&&(s.current.dispose(),s.current=null),s.current=X({socket:{subscribe:r.subscribe,emit:r.emit},config:t}),()=>{s.current&&(s.current.dispose(),s.current=null)}),[r,t]),h.jsxRuntimeExports.jsx(h.jsxRuntimeExports.Fragment,{children:e})},K="ai-events",J="event",Q="ai-control",W="command",Y=()=>{const{emit:e}=f(),t=i.useCallback(s=>{e(K,J,{...s,direction:"UI→AI"})},[e]),r=i.useCallback(s=>{e(Q,W,{...s,direction:"AI→UI"})},[e]);return i.useMemo(()=>({sendUiEvent:t,sendCommand:r}),[t,r])};exports.AiControlProvider=z;exports.SocketProvider=B;exports.auditLoggerMiddleware=w;exports.piiFilterMiddleware=U;exports.tokens=T;exports.useAiControl=Y;exports.useSocketContext=f;exports.useSocketEmit=q;exports.useSocketEvent=P;
