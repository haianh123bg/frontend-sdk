"use strict";var S=Object.defineProperty;var m=(e,s,i)=>s in e?S(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i;var u=(e,s,i)=>m(e,typeof s!="symbol"?s+"":s,i);const b=require("react");let n;const g=new Uint8Array(16);function I(){if(!n&&(n=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!n))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(g)}const c=[];for(let e=0;e<256;++e)c.push((e+256).toString(16).slice(1));function R(e,s=0){return c[e[s+0]]+c[e[s+1]]+c[e[s+2]]+c[e[s+3]]+"-"+c[e[s+4]]+c[e[s+5]]+"-"+c[e[s+6]]+c[e[s+7]]+"-"+c[e[s+8]]+c[e[s+9]]+"-"+c[e[s+10]]+c[e[s+11]]+c[e[s+12]]+c[e[s+13]]+c[e[s+14]]+c[e[s+15]]}const U=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),o={randomUUID:U};function d(e,s,i){if(o.randomUUID&&!e)return o.randomUUID();e=e||{};const r=e.random||(e.rng||I)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,R(r)}class a{constructor(){u(this,"subscribers",new Map);u(this,"globalSubscribers",new Set);u(this,"middlewares",[]);u(this,"handlerPipeline",null);this.handlerPipeline=async s=>{this.notifySubscribers(s)}}use(s){this.middlewares.push(s),this.rebuildPipeline()}rebuildPipeline(){let s=async i=>{this.notifySubscribers(i)};for(let i=this.middlewares.length-1;i>=0;i--)s=this.middlewares[i](s);this.handlerPipeline=s}notifySubscribers(s){const i=this.subscribers.get(s.type);i&&i.forEach(r=>{try{r(s)}catch(t){console.error(`[ActionBus] Error in subscriber for ${s.type}:`,t)}}),this.globalSubscribers.forEach(r=>{try{r(s)}catch(t){console.error("[ActionBus] Error in global subscriber:",t)}})}publish(s){const i={...s,id:d(),timestamp:Date.now()};this.handlerPipeline&&Promise.resolve(this.handlerPipeline(i)).catch(r=>{console.error("[ActionBus] Pipeline error:",r)})}subscribe(s,i){return this.subscribers.has(s)||this.subscribers.set(s,new Set),this.subscribers.get(s).add(i),{unsubscribe:()=>{const r=this.subscribers.get(s);r&&(r.delete(i),r.size===0&&this.subscribers.delete(s))}}}subscribeAll(s){return this.globalSubscribers.add(s),{unsubscribe:()=>{this.globalSubscribers.delete(s)}}}}const l=new a,E=()=>l,y=()=>b.useCallback((s,i,r)=>{l.publish({type:s,payload:i,source:(r==null?void 0:r.source)||"component",meta:r==null?void 0:r.meta,flags:r==null?void 0:r.flags})},[]),p=(e,s,i=[])=>{const r=b.useRef(s);b.useEffect(()=>{r.current=s},[s]),b.useEffect(()=>{const t=l.subscribe(e,A=>{r.current&&r.current(A)});return()=>{t.unsubscribe()}},[e,...i])},w=()=>{};var h=(e=>(e.UI_CLICK="UI.CLICK",e.UI_HOVER="UI.HOVER",e.UI_CHANGE="UI.CHANGE",e.FORM_SUBMIT="FORM.SUBMIT",e.FORM_VALIDATE="FORM.VALIDATE",e.SYSTEM_INIT="SYSTEM.INIT",e.SYSTEM_ERROR="SYSTEM.ERROR",e.NAV_ROUTE="NAV.ROUTE",e))(h||{});exports.ActionBus=a;exports.EventType=h;exports.actionBus=l;exports.useActionBus=E;exports.useAsyncAction=w;exports.useDispatchAction=y;exports.useSubscribeAction=p;exports.v4=d;
